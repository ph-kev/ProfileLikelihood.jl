<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · ProfileLikelihood.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ProfileLikelihood.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">ProfileLikelihood.jl: Estimating Parameters and Finding Profile Likelihood</a></li><li><a class="tocitem" href="../optimizer/">Optimizers</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Packages"><span>Packages</span></a></li><li><a class="tocitem" href="#Setting-up-the-problem"><span>Setting up the problem</span></a></li><li><a class="tocitem" href="#Generating-data"><span>Generating data</span></a></li><li><a class="tocitem" href="#Estimating-parameters"><span>Estimating parameters</span></a></li><li><a class="tocitem" href="#Threshold-and-constants"><span>Threshold and constants</span></a></li><li><a class="tocitem" href="#Profile-Likelihood"><span>Profile Likelihood</span></a></li><li><a class="tocitem" href="#Identifiability-analysis-and-confidence-interval-estimation"><span>Identifiability analysis and confidence interval estimation</span></a></li></ul></li><li><a class="tocitem" href="../api/">Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ph-kev/ProfileLikelihood.jl/blob/master/docs/src/tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>This tutorial highlights how <code>ProfileLikelihood.jl</code> can be used to generate data, estimate parameters, and find the profile likelihood. Furthermore, profile likelihood can be used for identifiability analysis and confidence intervals estimation. It is recommend to read the documentation for more information.</p><h2 id="Packages"><a class="docs-heading-anchor" href="#Packages">Packages</a><a id="Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Packages" title="Permalink"></a></h2><p>We load some useful packages.</p><pre><code class="language- hljs">using ProfileLikelihood, DifferentialEquations, Distributions, # for finding PL
Plots, LaTeXStrings, Measures, # for plotting
Interpolations # for finding CI</code></pre><h2 id="Setting-up-the-problem"><a class="docs-heading-anchor" href="#Setting-up-the-problem">Setting up the problem</a><a id="Setting-up-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-problem" title="Permalink"></a></h2><p>We will consider the simple <span>$SIR$</span> model. To set this up, we will use the <code>DifferentialEquations.jl</code> package.</p><pre><code class="language-julia hljs">function sir!(du, u, p, t)
    let (S, I, R, C, beta, gamma) = (u[1], u[2], u[3], u[4], p[1], p[2])
        du[1] = - beta * S * I
        du[2] = beta * S * I - gamma * I
        du[3] = gamma * I
        du[4] = beta * S * I
    end
end</code></pre><p>Note that none of the parameters are known. If we want to make a parameter known, we can simply put it as a <code>const</code> global variable. For instance, if we want to make beta known as 0.01, we would add the line <code>const beta = 0.0001</code> before defining the function <code>sir!</code>. Also, the variable <code>C</code> is the cumulative data of the infected.</p><p>We now set up the time span, initial conditions, and true parameters for the differential equation solver.</p><pre><code class="language-julia hljs">tspan = (0.0, 40.0)
p0 = [0.0001, 0.1]
u0 = [10000.0, 10.0, 0.0, 10.0]
prob = ODEProblem(sir!, u0, tspan, p0)</code></pre><p>Let plot what the solutions to the <span>$SIR$</span> model look like using the <code>Plots.jl</code> package.</p><pre><code class="language- hljs">sol = solve(prob, Tsit5(), reltol=1e-5, abstol=1e-10, dense=true)
sol_plot = plot(sol,plotdensity=1000, labels = [&quot;Suspectible&quot; &quot;Infected&quot; &quot;Recovered&quot; &quot;Cumulative Infected&quot;])</code></pre><h2 id="Generating-data"><a class="docs-heading-anchor" href="#Generating-data">Generating data</a><a id="Generating-data-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-data" title="Permalink"></a></h2><p>Let generate fake data to work with using the function <code>generate_data</code>. We will generate data of recovered and incidence data of infected. We will generate data at <span>$t=0$</span>, <span>$t=1$</span>, ..., and <span>$t=10$</span>. The second input to <code>generate_data</code> is the seed of the random number generator in case if noise is added. The third input accepts a function whose input are the values of the data points and output the noisy data. For this tutorial, we will add noise from the normal distribution and Poisson distribution using the <code>Distributions.jl</code> package. We will use the anonymous functions <code>i -&gt; truncated(Normal(i,30), lower = 0)</code> <code>i -&gt; Poisson(i)</code> to add noise. Note that if we want incidence data from cumulative data, we need to set <code>incidence_obs_status=true</code>. Also, we can pass keyword arguments to the differential equation solver the same way we did when we solve the differential equation earlier.</p><pre><code class="language-julia hljs">times = LinRange{Float64}(0.0, 10.0, 11)
perfect_data_recovered, noisy_data_recovered = generate_data(3, 111, i -&gt; truncated(Normal(i,30), lower=0),
prob, Tsit5(), times; incidence_obs_status=false, abstol=1e-10, reltol=1e-5)
perfect_data_incidence_infected, noisy_data_incidence_infected = generate_data(4, 111,
i -&gt; Poisson(i), prob, Tsit5(), times; incidence_obs_status=true, abstol=1e-10, reltol=1e-5)</code></pre><p>Let plot the perfect and noisy data of recovered!</p><pre><code class="language- hljs">plt_recovered = plot(times, perfect_data_recovered, dpi = 400,
labels = &quot;Perfect Recovered Data&quot;, xlabel = L&quot;t&quot;, ylabel = &quot;Recovered Data&quot;)
plot!(times, noisy_data_recovered, labels = &quot;Noisy Recovered Data&quot;)</code></pre><p>Let also plot the perfect and noisy incidence data of infected!</p><pre><code class="language- hljs">plt_incidence_infected = plot(times, perfect_data_incidence_infected, dpi = 400,
labels = &quot;Perfect Incidence Data&quot;, xlabel = L&quot;t&quot;, ylabel = &quot;Incidence Data of Infected&quot;)
plot!(times, noisy_data_incidence_infected, labels = &quot;Noisy Incidence Infected Data&quot;)</code></pre><h2 id="Estimating-parameters"><a class="docs-heading-anchor" href="#Estimating-parameters">Estimating parameters</a><a id="Estimating-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Estimating-parameters" title="Permalink"></a></h2><p>Since there is only data from <span>$t=0$</span> to <span>$t=10$</span>, we can change <code>tspan</code> and remake the ODE problem. This saves the computer from doing unnecessary computations.</p><pre><code class="language-julia hljs">tspan = (0.0, 10.0)
prob = remake(prob; tspan = tspan)</code></pre><p>Let fit the <span>$SIR$</span> model to the noisy data that we have generated. The package <code>ProfileLikelihood.jl</code> already have objective functions derived from maxmimum likelihood estimation. The third input of <code>const_variance_error</code> is the standard deviation of the noise distribution which is <span>$σ = 30$</span>.</p><pre><code class="language-julia hljs">obj_const_variance = (data, sol) -&gt; const_variance_error(data, sol, 30.0)
obj_poisson = (data, sol) -&gt; poisson_error(data, sol)</code></pre><p>To estimate parameters, we use the function <code>estimate_params</code>. This accepts the keywords <code>solver_diff_opts</code>, <code>opti_prob_opts</code>, and <code>opti_solver_opts</code> for the differential equation solver, optimization problem, and optimization solver. See the documentation for more information.</p><pre><code class="language-julia hljs">solver_diff_opts = Dict(
    :reltol =&gt; 1e-5,
    :abstol =&gt; 1e-10,
)</code></pre><p>The first input to <code>estimate_params</code> is the initial guess of parameters, the second input is any non-incidence data, and the third input is the indices of the state variables of the DEs that we are interested in. The eighth, ninth, and tenth inputs are the optimizaiton algorithm, lower bounds, and upper bounds. For more information, see the <code>ProfileLikelihood.jl</code> documentation and <code>Optimization.jl</code> documentation. For this tutorial, we will use the <code>NOMADOpt()</code> optimization algorithm from the package <code>NOMAD.jl</code> package.</p><pre><code class="language-julia hljs">initial_guess = [1.0, 1.0]
loss, fitted_params = estimate_params(initial_guess, [noisy_data_recovered, noisy_data_incidence_infected],
[3], prob, Tsit5(), times, [obj_const_variance, obj_poisson], NOMADOpt(), [0.0, 0.0], [3.0, 3.0];
incidence_obs = [4], solver_diff_opts=solver_diff_opts)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(437736.265806, [1.04172910285877, 3.8283479e-7])</code></pre><p>This does not look quite right as we know the true parameters is <code>[0.0001, 0.1]</code>. We will try again with another optimization algorithm. We will use the <code>DE()</code> algorithm from the <code>Metaheuristics.jl</code> package.</p><pre><code class="language-julia hljs">loss, fitted_params = estimate_params(initial_guess, [noisy_data_recovered, noisy_data_incidence_infected],
[3], prob, Tsit5(), times, [obj_const_variance, obj_poisson], OptimizationMetaheuristics.DE(N=50),
[0.0, 0.0], [3.0, 3.0]; incidence_obs = [4], solver_diff_opts=solver_diff_opts, print_status = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(-110746.88030116101, [0.0001002467358120473, 0.10091604830037637])</code></pre><p>To make sure this is the global minimum, we can use another optimization algorithm. We will use the <code>generating_set_search</code> from <code>BlackBoxOptim.jl</code>.</p><pre><code class="language-julia hljs">opti_solver_opts = Dict(
    :maxtime =&gt; 120.0, # how long for it to run in seconds
    :f_calls_limit =&gt; 1000000,
    :iterations =&gt; 2000000,
    :TraceInterval =&gt; 10.0 # print results every 10.0 seconds
)

loss, fitted_params = estimate_params(initial_guess, [noisy_data_recovered, noisy_data_incidence_infected],
[3], prob, Tsit5(), times, [obj_const_variance, obj_poisson], BBO_generating_set_search(),
[0.0, 0.0], [3.0, 3.0]; incidence_obs = [4], solver_diff_opts=solver_diff_opts,
opti_solver_opts = opti_solver_opts)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(-110746.88030113184, [0.00010024677673704646, 0.10091591812670242])</code></pre><p>That matches close with what we got with the <code>DE()</code> algorithm from the <code>Metaheuristics.jl</code> package!</p><h2 id="Threshold-and-constants"><a class="docs-heading-anchor" href="#Threshold-and-constants">Threshold and constants</a><a id="Threshold-and-constants-1"></a><a class="docs-heading-anchor-permalink" href="#Threshold-and-constants" title="Permalink"></a></h2><p>For profile likelihood, we can calculate likelihood-based confidence intervals using a threshold. Since there are two unknown parameters, we use <span>$df=2$</span> for simultaneous confidence intervals and <span>$df=1$</span> for pointwise confidence interval. For more information, read Raue et. al&#39;s &quot;Exploiting Profile Likelihood&quot;.</p><pre><code class="language-julia hljs">threshold_simu = find_threshold(0.95, 2, loss)
threshold_poin = find_threshold(0.95, 1, loss)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-110743.03884231114</code></pre><p>Furthermore, for the profile likelihood plots, we dropped the constants when finding the minimizer. We can add the constant back when making the profile likelihood plots.</p><pre><code class="language-julia hljs">pl_const_const_variance = likelihood_const(&quot;const_variance_error&quot;; times = times, sigma = 30)
pl_const_poisson = likelihood_const(&quot;poisson_error&quot;; data = noisy_data_incidence_infected)
pl_const = pl_const_const_variance + pl_const_poisson</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">110934.27261204975</code></pre><h2 id="Profile-Likelihood"><a class="docs-heading-anchor" href="#Profile-Likelihood">Profile Likelihood</a><a id="Profile-Likelihood-1"></a><a class="docs-heading-anchor-permalink" href="#Profile-Likelihood" title="Permalink"></a></h2><p>We can now plot the profile likelihood. The algorithm implemented explore the profile likelihood by taking steps of equal size in both right and left directions. The first and second argument is the step size and number of steps to take for one direction respectively. The third argument tells the function what parameter we want to fix when plotting the profile likelihood. The seventh argument is the value at which the algorithm will stop computing points if the loss of the computed points is greater than the minimum loss plus the value. We will use the threshold computed earlier plus a small number so that the algorithm explore the profile likelihood a bit more.</p><p>The plot of the profile likelihood of <span>$β$</span> is shown below.</p><pre><code class="language- hljs">theta_beta, sol_beta = find_profile_likelihood(2e-8, 50, 1, fitted_params,
[noisy_data_recovered, noisy_data_incidence_infected], [3], threshold_simu + 3, loss, prob,
Tsit5(), times, [obj_const_variance, obj_poisson], NOMADOpt(), [0.0, 0.0], [3.0, 3.0];
incidence_obs = [4], solver_diff_opts=solver_diff_opts,
pl_const = pl_const,
print_status = false)
PL_beta = plot(theta_beta, [sol_beta, (x) -&gt; (threshold_simu + pl_const), (x) -&gt; (threshold_poin + pl_const)],
xlabel = L&quot;\beta&quot;, ylabel = L&quot;\chi^2_{\rm PL}&quot;, yformatter = :plain, legend=:topright,
labels = [L&quot;\chi^2_{\rm PL}&quot; &quot;Simultaneous Threshold&quot; &quot;Pointwise Threshold&quot;], right_margin=5mm,
dpi = 400)
scatter!([fitted_params[1]], [loss + pl_const], color = &quot;orange&quot;, labels = &quot;Fitted Parameter&quot;)</code></pre><p>The plot of the profile likelihood of <span>$γ$</span> is shown below.</p><pre><code class="language- hljs">theta_gamma, sol_gamma = find_profile_likelihood(3e-4, 50, 2, fitted_params,
[noisy_data_recovered, noisy_data_incidence_infected], [3], threshold_simu + 3, loss, prob,
Tsit5(), times, [obj_const_variance, obj_poisson], NOMADOpt(), [0.0, 0.0], [3.0, 3.0];
incidence_obs = [4], solver_diff_opts=solver_diff_opts, pl_const = pl_const,
print_status = false)
PL_gamma = plot(theta_gamma, [sol_gamma, (x) -&gt; (threshold_simu + pl_const), (x) -&gt; (threshold_poin + pl_const)],
xlabel = L&quot;\gamma&quot;, ylabel = L&quot;\chi^2_{\rm PL}&quot;, yformatter = :plain, legend=:topright,
labels = [L&quot;\chi^2_{\rm PL}&quot; &quot;Simultaneous Threshold&quot; &quot;Pointwise Threshold&quot;], right_margin=5mm,
dpi = 400)
scatter!([fitted_params[2]], [loss + pl_const], color = &quot;orange&quot;, labels = &quot;Fitted Parameter&quot;)</code></pre><h2 id="Identifiability-analysis-and-confidence-interval-estimation"><a class="docs-heading-anchor" href="#Identifiability-analysis-and-confidence-interval-estimation">Identifiability analysis and confidence interval estimation</a><a id="Identifiability-analysis-and-confidence-interval-estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Identifiability-analysis-and-confidence-interval-estimation" title="Permalink"></a></h2><p>If the confidence intervals are finite and the global minimum is unique, then the parameter is practically identifiable. If the conifdence interval is not finite, then the parameter is not practically identifiable. From the profile likelihood plots, the parameters <span>$β$</span> and <span>$γ$</span> are practically identifiable.</p><p>The confidence intervals are determined by the intercepts of the threshold and the profile likelihood plot. For this tutorial, we will find simultaneous confidence intervals. We use the <code>Interpolations.jl</code> package to make a linear interpolant of the points found.</p><pre><code class="language- hljs">beta_inter = linear_interpolation(theta_beta, sol_beta)
gamma_inter = linear_interpolation(theta_gamma, sol_gamma)
nothing # hide</code></pre><p>We can use <code>find_roots()</code> from the <code>ProfileLikelihood.jl</code> package.</p><p>The simultaneous confidence interval of <span>$β$</span> is <span>$[9.953 \cdot 10^{-5}, 0.000101]$</span>.</p><pre><code class="language- hljs">ci_simu_beta_h = find_roots(beta_inter, theta_beta, threshold_simu + pl_const)</code></pre><p>The simultaneous confidence interval of <span>$γ$</span> is <span>$[0.0940,0.102]$</span>.</p><pre><code class="language- hljs">ci_simu_beta_v = find_roots(gamma_inter, theta_gamma, threshold_simu + pl_const)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../optimizer/">« Optimizers</a><a class="docs-footer-nextpage" href="../api/">Documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Tuesday 23 August 2022 01:11">Tuesday 23 August 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
